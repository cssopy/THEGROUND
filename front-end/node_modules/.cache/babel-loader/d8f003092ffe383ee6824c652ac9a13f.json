{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect } from \"react\";\nimport axios from \"axios\";\nimport { userActions } from \"../../redux/slice/userSlice\";\nimport usersActions from \"../../redux/thunkActions/userActions\";\nimport { useDispatch } from \"react-redux\";\nimport logosActions from \"../../redux/thunkActions/logoActions\";\nimport playersActions from \"../../redux/thunkActions/playerActions\";\nimport BackApi from \"../../api/BackApi\";\nimport SocialApi from \"../../api/SocialApi\";\nimport { configActions } from \"../../redux/slice/configSlice\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst LoginHandler = props => {\n  _s();\n\n  const {\n    loginType\n  } = props;\n  const dispatch = useDispatch();\n  let loginUrl;\n  const CODE = new URL(window.location.href).searchParams.get(\"code\");\n  const STATE = new URL(window.location.href).searchParams.get(\"state\");\n\n  if (loginType === \"N\") {\n    loginUrl = SocialApi.naver.login(CODE, STATE);\n  } else if (loginType === \"K\") {\n    loginUrl = SocialApi.kakao.login(CODE);\n  } else if (loginType === \"G\") {\n    loginUrl = SocialApi.google.login(CODE);\n  } // 네이버로 토큰 발급 요청\n\n\n  const getToken = () => {\n    dispatch(configActions.setIsLoading(true));\n    axios.post(loginUrl, {\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded;charset=utf-8\"\n      }\n    }, {\n      responseType: \"json\"\n    }).then(res => res.data).then(data => {\n      // 액세스 토큰으로 로그인 요청\n      if (data.access_token) {\n        axios.post(BackApi.users.login, {\n          accessToken: data.access_token,\n          loginType\n        }, {\n          headers: {\n            \"Content-type\": \"application/json\",\n            Accept: \"application/json\"\n          }\n        }).then(res => {\n          dispatch(configActions.setPersentage(30));\n          dispatch(logosActions.getLogoAPI());\n\n          if (res.data.message === \"회원가입을 먼저 해주세요.\") {\n            dispatch(configActions.setPersentage(100)); // 회원가입을 위해 uid를 저장 후 이동\n            // loginType은 로컬 스토리지에 있음\n\n            dispatch(userActions.setUid(res.data.uid));\n            dispatch(configActions.setUrl(\"\"));\n          } else {\n            // jwt 토큰과 유저 이름을 저장 후 메인 페이지로 이동\n            // 메인 페이지 이동 시 선수 전체 데이터와 유저 데이터를 요청 및 저장\n            dispatch(configActions.setPersentage(100));\n            dispatch(playersActions.getPlayerAPI());\n            dispatch(userActions.setJwt(res.data.jwt));\n            dispatch(userActions.setLoginType(\"\"));\n            dispatch(usersActions.getUserAPI(res.data.jwt));\n            dispatch(configActions.setUrl(\"main\"));\n          }\n        });\n      } else {\n        dispatch(configActions.setPersentage(100));\n        dispatch(configActions.setUrl(\"\"));\n      }\n    }).catch(err => console.log(err));\n  }; // 취소시 로직\n\n\n  let error = new URL(window.location.href).searchParams.get(\"error_description\");\n  useEffect(() => {\n    if (loginType) {\n      getToken();\n    }\n\n    if (error === \"Canceled By User\") {\n      dispatch(configActions.setUrl(\"\"));\n    }\n  });\n  return /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n};\n\n_s(LoginHandler, \"rAh3tY+Iv6hWC9AI4Dm+rCbkwNE=\", false, function () {\n  return [useDispatch];\n});\n\n_c = LoginHandler;\nexport default LoginHandler;\n\nvar _c;\n\n$RefreshReg$(_c, \"LoginHandler\");","map":{"version":3,"names":["useEffect","axios","userActions","usersActions","useDispatch","logosActions","playersActions","BackApi","SocialApi","configActions","LoginHandler","props","loginType","dispatch","loginUrl","CODE","URL","window","location","href","searchParams","get","STATE","naver","login","kakao","google","getToken","setIsLoading","post","headers","responseType","then","res","data","access_token","users","accessToken","Accept","setPersentage","getLogoAPI","message","setUid","uid","setUrl","getPlayerAPI","setJwt","jwt","setLoginType","getUserAPI","catch","err","console","log","error"],"sources":["C:/Users/multicampus/Desktop/projects/theground/front-end/src/landing/components/LoginHandler.js"],"sourcesContent":["import { useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { userActions } from \"../../redux/slice/userSlice\";\r\nimport usersActions from \"../../redux/thunkActions/userActions\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport logosActions from \"../../redux/thunkActions/logoActions\";\r\nimport playersActions from \"../../redux/thunkActions/playerActions\";\r\nimport BackApi from \"../../api/BackApi\";\r\nimport SocialApi from \"../../api/SocialApi\";\r\nimport { configActions } from \"../../redux/slice/configSlice\";\r\n\r\nconst LoginHandler = (props) => {\r\n  const { loginType } = props;\r\n  const dispatch = useDispatch();\r\n\r\n  let loginUrl;\r\n  const CODE = new URL(window.location.href).searchParams.get(\"code\");\r\n  const STATE = new URL(window.location.href).searchParams.get(\"state\");\r\n\r\n  if (loginType === \"N\") {\r\n    loginUrl = SocialApi.naver.login(CODE, STATE);\r\n  } else if (loginType === \"K\") {\r\n    loginUrl = SocialApi.kakao.login(CODE);\r\n  } else if (loginType === \"G\") {\r\n    loginUrl = SocialApi.google.login(CODE);\r\n  }\r\n\r\n  // 네이버로 토큰 발급 요청\r\n  const getToken = () => {\r\n    dispatch(configActions.setIsLoading(true));\r\n    axios\r\n      .post(\r\n        loginUrl,\r\n        {\r\n          headers: {\r\n            \"Content-Type\": \"application/x-www-form-urlencoded;charset=utf-8\",\r\n          },\r\n        },\r\n        {\r\n          responseType: \"json\",\r\n        }\r\n      )\r\n      .then((res) => res.data)\r\n      .then((data) => {\r\n        // 액세스 토큰으로 로그인 요청\r\n        if (data.access_token) {\r\n          axios\r\n            .post(\r\n              BackApi.users.login,\r\n              {\r\n                accessToken: data.access_token,\r\n                loginType,\r\n              },\r\n              {\r\n                headers: {\r\n                  \"Content-type\": \"application/json\",\r\n                  Accept: \"application/json\",\r\n                },\r\n              }\r\n            )\r\n            .then((res) => {\r\n              dispatch(configActions.setPersentage(30));\r\n              dispatch(logosActions.getLogoAPI());\r\n              if (res.data.message === \"회원가입을 먼저 해주세요.\") {\r\n                dispatch(configActions.setPersentage(100));\r\n                // 회원가입을 위해 uid를 저장 후 이동\r\n                // loginType은 로컬 스토리지에 있음\r\n                dispatch(userActions.setUid(res.data.uid));\r\n                dispatch(configActions.setUrl(\"\"));\r\n              } else {\r\n                // jwt 토큰과 유저 이름을 저장 후 메인 페이지로 이동\r\n                // 메인 페이지 이동 시 선수 전체 데이터와 유저 데이터를 요청 및 저장\r\n                dispatch(configActions.setPersentage(100));\r\n                dispatch(playersActions.getPlayerAPI());\r\n                dispatch(userActions.setJwt(res.data.jwt));\r\n                dispatch(userActions.setLoginType(\"\"));\r\n                dispatch(usersActions.getUserAPI(res.data.jwt));\r\n                dispatch(configActions.setUrl(\"main\"));\r\n              }\r\n            });\r\n        } else {\r\n          dispatch(configActions.setPersentage(100));\r\n          dispatch(configActions.setUrl(\"\"));\r\n        }\r\n      })\r\n      .catch((err) => console.log(err));\r\n  };\r\n\r\n  // 취소시 로직\r\n  let error = new URL(window.location.href).searchParams.get(\r\n    \"error_description\"\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (loginType) {\r\n      getToken();\r\n    }\r\n    if (error === \"Canceled By User\") {\r\n      dispatch(configActions.setUrl(\"\"));\r\n    }\r\n  });\r\n\r\n  return <></>;\r\n};\r\n\r\nexport default LoginHandler;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}