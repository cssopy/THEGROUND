{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect } from \"react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { userActions } from \"../../slice/UserSlice\";\nimport { useDispatch } from \"react-redux/es/exports\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst GoogleLoginHandler = props => {\n  _s();\n\n  const {\n    loginType\n  } = props;\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const CLIENT_ID = \"824400159984-9lg3ubjictcle5lbsbj39s076lko1fhh.apps.googleusercontent.com\";\n  const CLIENT_SECRET = \"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\";\n  const REDIRECT_URI = \"https://j7d109.p.ssafy.io\"; // const REDIRECT_URI = \"http://localhost:3000\";\n  // 인가코드\n\n  const location = useLocation();\n  const CODE = location.search.split(\"=\")[1]; // 구글로 액세스 토큰 발급 요청\n\n  const getGoogleToken = () => {\n    axios.post(`https://www.googleapis.com/oauth2/v4/token?code=${CODE}&client_id=${CLIENT_ID}&client_secret=${CLIENT_SECRET}&grant_type=authorization_code&redirect_uri=${REDIRECT_URI}`, {\n      responseType: \"json\"\n    }).then(res => res.data).then(data => {\n      // 액세스 토큰으로 로그인 요청\n      if (data.access_token) {\n        axios.post(\"https://j7d109.p.ssafy.io/back/users/login\", {\n          accessToken: data.access_token,\n          loginType: \"G\"\n        }, {\n          headers: {\n            \"Content-type\": \"application/json\",\n            Accept: \"application/json\"\n          }\n        }).then(res => {\n          if (res.data.message === \"회원가입을 먼저 해주세요.\") {\n            // 회원가입을 위해 uid를 저장 후 이동\n            // loginType은 로컬 스토리지에 있음\n            dispatch(userActions.setUid(res.data.uid));\n            navigate(\"/\");\n          } else {\n            // jwt 토큰과 유저 이름을 저장 후 메인 페이지로 이동\n            dispatch(userActions.setJwtToken(res.data.jwt));\n            dispatch(userActions.setUserTeamname(res.data.userTeamname));\n            localStorage.removeItem(\"loginType\");\n            localStorage.setItem(\"jwt\", res.data.jwt);\n            navigate(\"/main\");\n          }\n        });\n      } else {\n        navigate(\"/\");\n      }\n    });\n  }; // 취소시 로직\n\n\n  let error = new URL(window.location.href).searchParams.get(\"error_description\");\n  useEffect(() => {\n    if (!CODE) return;\n\n    if (loginType === \"G\") {\n      getGoogleToken();\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n};\n\n_s(GoogleLoginHandler, \"HReNSOYK3/ZdS3BkR1y0pyqHvQA=\", false, function () {\n  return [useNavigate, useDispatch, useLocation];\n});\n\n_c = GoogleLoginHandler;\nexport default GoogleLoginHandler;\n\nvar _c;\n\n$RefreshReg$(_c, \"GoogleLoginHandler\");","map":{"version":3,"names":["useEffect","useLocation","useNavigate","axios","userActions","useDispatch","GoogleLoginHandler","props","loginType","navigate","dispatch","CLIENT_ID","CLIENT_SECRET","REDIRECT_URI","location","CODE","search","split","getGoogleToken","post","responseType","then","res","data","access_token","accessToken","headers","Accept","message","setUid","uid","setJwtToken","jwt","setUserTeamname","userTeamname","localStorage","removeItem","setItem","error","URL","window","href","searchParams","get"],"sources":["C:/Users/multicampus/Desktop/projects/theground/front-end/src/landing/components/GoogleLoginHandler.js"],"sourcesContent":["import { useEffect } from \"react\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { userActions } from \"../../slice/UserSlice\";\r\nimport { useDispatch } from \"react-redux/es/exports\";\r\n\r\nconst GoogleLoginHandler = (props) => {\r\n  const { loginType } = props;\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n\r\n  const CLIENT_ID =\r\n    \"824400159984-9lg3ubjictcle5lbsbj39s076lko1fhh.apps.googleusercontent.com\";\r\n  const CLIENT_SECRET = \"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\";\r\n  const REDIRECT_URI = \"https://j7d109.p.ssafy.io\";\r\n  // const REDIRECT_URI = \"http://localhost:3000\";\r\n\r\n  // 인가코드\r\n  const location = useLocation();\r\n  const CODE = location.search.split(\"=\")[1];\r\n\r\n  // 구글로 액세스 토큰 발급 요청\r\n  const getGoogleToken = () => {\r\n    axios\r\n      .post(\r\n        `https://www.googleapis.com/oauth2/v4/token?code=${CODE}&client_id=${CLIENT_ID}&client_secret=${CLIENT_SECRET}&grant_type=authorization_code&redirect_uri=${REDIRECT_URI}`,\r\n        {\r\n          responseType: \"json\",\r\n        }\r\n      )\r\n      .then((res) => res.data)\r\n      .then((data) => {\r\n        // 액세스 토큰으로 로그인 요청\r\n        if (data.access_token) {\r\n          axios\r\n            .post(\r\n              \"https://j7d109.p.ssafy.io/back/users/login\",\r\n              {\r\n                accessToken: data.access_token,\r\n                loginType: \"G\",\r\n              },\r\n              {\r\n                headers: {\r\n                  \"Content-type\": \"application/json\",\r\n                  Accept: \"application/json\",\r\n                },\r\n              }\r\n            )\r\n            .then((res) => {\r\n              if (res.data.message === \"회원가입을 먼저 해주세요.\") {\r\n                // 회원가입을 위해 uid를 저장 후 이동\r\n                // loginType은 로컬 스토리지에 있음\r\n                dispatch(userActions.setUid(res.data.uid));\r\n                navigate(\"/\");\r\n              } else {\r\n                // jwt 토큰과 유저 이름을 저장 후 메인 페이지로 이동\r\n                dispatch(userActions.setJwtToken(res.data.jwt));\r\n                dispatch(userActions.setUserTeamname(res.data.userTeamname));\r\n                localStorage.removeItem(\"loginType\");\r\n                localStorage.setItem(\"jwt\", res.data.jwt);\r\n                navigate(\"/main\");\r\n              }\r\n            });\r\n        } else {\r\n          navigate(\"/\");\r\n        }\r\n      });\r\n  };\r\n\r\n  // 취소시 로직\r\n  let error = new URL(window.location.href).searchParams.get(\r\n    \"error_description\"\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!CODE) return;\r\n    if (loginType === \"G\") {\r\n      getGoogleToken();\r\n    }\r\n  }, []);\r\n\r\n  return <></>;\r\n};\r\n\r\nexport default GoogleLoginHandler;\r\n"],"mappings":";;AAAA,SAASA,SAAT,QAA0B,OAA1B;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,kBAAzC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,WAAT,QAA4B,uBAA5B;AACA,SAASC,WAAT,QAA4B,wBAA5B;;;;AAEA,MAAMC,kBAAkB,GAAIC,KAAD,IAAW;EAAA;;EACpC,MAAM;IAAEC;EAAF,IAAgBD,KAAtB;EACA,MAAME,QAAQ,GAAGP,WAAW,EAA5B;EACA,MAAMQ,QAAQ,GAAGL,WAAW,EAA5B;EAEA,MAAMM,SAAS,GACb,0EADF;EAEA,MAAMC,aAAa,GAAG,qCAAtB;EACA,MAAMC,YAAY,GAAG,2BAArB,CARoC,CASpC;EAEA;;EACA,MAAMC,QAAQ,GAAGb,WAAW,EAA5B;EACA,MAAMc,IAAI,GAAGD,QAAQ,CAACE,MAAT,CAAgBC,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAb,CAboC,CAepC;;EACA,MAAMC,cAAc,GAAG,MAAM;IAC3Bf,KAAK,CACFgB,IADH,CAEK,mDAAkDJ,IAAK,cAAaJ,SAAU,kBAAiBC,aAAc,+CAA8CC,YAAa,EAF7K,EAGI;MACEO,YAAY,EAAE;IADhB,CAHJ,EAOGC,IAPH,CAOSC,GAAD,IAASA,GAAG,CAACC,IAPrB,EAQGF,IARH,CAQSE,IAAD,IAAU;MACd;MACA,IAAIA,IAAI,CAACC,YAAT,EAAuB;QACrBrB,KAAK,CACFgB,IADH,CAEI,4CAFJ,EAGI;UACEM,WAAW,EAAEF,IAAI,CAACC,YADpB;UAEEhB,SAAS,EAAE;QAFb,CAHJ,EAOI;UACEkB,OAAO,EAAE;YACP,gBAAgB,kBADT;YAEPC,MAAM,EAAE;UAFD;QADX,CAPJ,EAcGN,IAdH,CAcSC,GAAD,IAAS;UACb,IAAIA,GAAG,CAACC,IAAJ,CAASK,OAAT,KAAqB,gBAAzB,EAA2C;YACzC;YACA;YACAlB,QAAQ,CAACN,WAAW,CAACyB,MAAZ,CAAmBP,GAAG,CAACC,IAAJ,CAASO,GAA5B,CAAD,CAAR;YACArB,QAAQ,CAAC,GAAD,CAAR;UACD,CALD,MAKO;YACL;YACAC,QAAQ,CAACN,WAAW,CAAC2B,WAAZ,CAAwBT,GAAG,CAACC,IAAJ,CAASS,GAAjC,CAAD,CAAR;YACAtB,QAAQ,CAACN,WAAW,CAAC6B,eAAZ,CAA4BX,GAAG,CAACC,IAAJ,CAASW,YAArC,CAAD,CAAR;YACAC,YAAY,CAACC,UAAb,CAAwB,WAAxB;YACAD,YAAY,CAACE,OAAb,CAAqB,KAArB,EAA4Bf,GAAG,CAACC,IAAJ,CAASS,GAArC;YACAvB,QAAQ,CAAC,OAAD,CAAR;UACD;QACF,CA5BH;MA6BD,CA9BD,MA8BO;QACLA,QAAQ,CAAC,GAAD,CAAR;MACD;IACF,CA3CH;EA4CD,CA7CD,CAhBoC,CA+DpC;;;EACA,IAAI6B,KAAK,GAAG,IAAIC,GAAJ,CAAQC,MAAM,CAAC1B,QAAP,CAAgB2B,IAAxB,EAA8BC,YAA9B,CAA2CC,GAA3C,CACV,mBADU,CAAZ;EAIA3C,SAAS,CAAC,MAAM;IACd,IAAI,CAACe,IAAL,EAAW;;IACX,IAAIP,SAAS,KAAK,GAAlB,EAAuB;MACrBU,cAAc;IACf;EACF,CALQ,EAKN,EALM,CAAT;EAOA,oBAAO,qCAAP;AACD,CA5ED;;GAAMZ,kB;UAEaJ,W,EACAG,W,EASAJ,W;;;KAZbK,kB;AA8EN,eAAeA,kBAAf"},"metadata":{},"sourceType":"module"}